From 7d28d7b28c36eca63f25f29ce3c2b47d86a21df9 Mon Sep 17 00:00:00 2001
From: Lewis Brown <lewisb@xlnx.xilinx.com>
Date: Mon, 12 Jul 2021 13:01:38 +0100
Subject: [PATCH] Apply extended memory patch for RFSoC2x2

---
 board/xilinx/common/board.c | 19 +++++++++----------
 1 file changed, 9 insertions(+), 10 deletions(-)

diff --git a/board/xilinx/common/board.c b/board/xilinx/common/board.c
index 2b53e5e3b5..58beefd6c2 100644
--- a/board/xilinx/common/board.c
+++ b/board/xilinx/common/board.c
@@ -22,16 +22,15 @@ int zynq_board_read_rom_ethaddr(unsigned char *ethaddr)
 	struct udevice *dev;
 	ofnode eeprom;
 
-	eeprom = ofnode_get_chosen_node("xlnx,eeprom");
-	if (!ofnode_valid(eeprom))
-		return -ENODEV;
-
-	debug("%s: Path to EEPROM %s\n", __func__,
-	      ofnode_read_chosen_string("xlnx,eeprom"));
-
-	ret = uclass_get_device_by_ofnode(UCLASS_I2C_EEPROM, eeprom, &dev);
-	if (ret)
-		return ret;
++	/* 
++	 * Reading of extended memory is not supported by the driver
++	 * Use customized code to read out MAC address
++	 */
++	ret = i2c_get_chip_for_busnum(2, CONFIG_SYS_I2C_EEPROM_ADDR, 1, &dev);
++	if (ret){
++		printf("Failed to get chip for bus 2\n");
+ 		return ret;
++	}
 
 	ret = dm_i2c_read(dev, CONFIG_ZYNQ_GEM_I2C_MAC_OFFSET, ethaddr, 6);
 	if (ret)
-- 
2.17.1

